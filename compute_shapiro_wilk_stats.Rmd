---
title: "Compute Shapiro-Wilk statistics"
output: html_document
date: "2024-07-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The program calculates and returns the test statistics W used in a Shapiroâ€“Wilk test used to determine if the sample is normally distributed

```{r}
compute_shapiro_wilk_test <- function(data, plot_qq = FALSE) {
    #input validation
    if (!is.vector(data, mode = "numeric")) stop("Data must be a numeric vector")
    if (any(is.na(data))) stop("Data contains NA values.")
    if (any(is.infinite(data))) stop("Data contains infinite values.")
    if (length(data) < 3) stop("Data must contain at least 3 observations
                               for the Shapiro-Wilk test to be meaningful.")
    
    n <- length(data)
    sorted_data <- sort(data)
    
    # Calculate mean and standard deviation of the data
    mean_data <- mean(sorted_data)
    sd_data <- sd(sorted_data)
    
    # Calculate expected normal order statistics
    m <- qnorm((1:n - 0.375) / (n + 0.25))
    
    # Calculate Shapiro-Wilk W statistic
    W <- sum((sorted_data - mean_data) * m)^2 / ((n - 1) * sd_data^2)
    
    if (plot_qq) {
        qqnorm(data, main="QQ Plot")
        qqline(data, col = "blue")
    }
    
    return(W)
}
```

